(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-64609941"],{"0b0f":function(e,t,s){"use strict";var a=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"container"},[s("div",{ref:"messageArea",staticClass:"message-area"},[e._l(e.messages,(function(e,t){return s("TextBlock",{key:t,attrs:{message:e}})})),s("div",{ref:"ninja"})],2),-1!==e.chattingRoomId?s("form",{staticClass:"type-area",on:{submit:function(t){return t.preventDefault(),t.stopPropagation(),e.handleSubmit(t)}}},[s("div",{staticClass:"text"},[s("input",{directives:[{name:"model",rawName:"v-model",value:e.text,expression:"text"}],attrs:{type:"text",required:""},domProps:{value:e.text},on:{input:function(t){t.target.composing||(e.text=t.target.value)}}})]),s("button",{staticClass:"submit",attrs:{type:"submit"}},[s("font-awesome-icon",{staticClass:"icon",attrs:{icon:"play"}})],1)]):s("p",{staticClass:"text-center text-muted"},[e._v("選擇一個對象來聊天吧！")])])},n=[],r=s("5530"),i=(s("a9e3"),s("498a"),function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"text-block"},["self"===e.message.type?s("div",{staticClass:"bubble bubble-self"},[s("p",{staticClass:"message message-self"},[e._v(e._s(e.message.text))]),s("p",{staticClass:"text-muted text-sm"},[e._v(e._s(e._f("time")(e.message.createdAt)))])]):e._e(),"other"===e.message.type?s("div",{staticClass:"bubble bubble-other"},[s("div",{staticClass:"bubble-other-left"},[s("img",{attrs:{src:e._f("emptyImage")(e.message.userAvatar),alt:"user-avatar"}})]),s("div",{staticClass:"bubble-other-right"},[s("span",{staticClass:"text-muted text-sm other-name"},[e._v(e._s(e.message.userName))]),s("p",{staticClass:"message message-other"},[e._v(e._s(e.message.text))]),s("p",{staticClass:"text-muted text-sm"},[e._v(e._s(e._f("time")(e.message.createdAt)))])])]):e._e(),"system"===e.message.type?s("div",{staticClass:"bubble bubble-system"},[s("p",{staticClass:" message message-system"},[e._v(e._s(e.message.text))])]):e._e()])}),c=[],o=s("2708"),u={props:{message:{default:{userId:-1,type:"",userName:"",suerAvatar:"",text:"",createdAt:""}}},mixins:[o["c"],o["a"]]},l=u,f=(s("4352"),s("2877")),m=Object(f["a"])(l,i,c,!1,null,"16f6de53",null),d=m.exports,p=s("2f62"),g=s("2fa3"),v=s("56d7"),b={components:{TextBlock:d},props:{messages:{type:Array,required:!0},chattingRoomId:{type:Number,default:void 0}},data:function(){return{text:""}},methods:{scrollBottom:function(){this.$refs.ninja.scrollIntoView()},handleSubmit:function(){if(!this.text.trim())return g["a"].fire({icon:"warning",title:"請輸入訊息內容再發送"}),void(this.text="");if(this.chattingRoomId){var e={senderId:this.currentUser.id,roomId:this.chattingRoomId,text:this.text};return console.log("private message sent: ",e),v["socket"].emit("sendPrivate",e),void(this.text="")}var t={userId:this.currentUser.id,text:this.text};console.log("public message sent: ",t),v["socket"].emit("sendPublic",t),this.text=""}},computed:Object(r["a"])({},Object(p["b"])(["currentUser"])),watch:{messages:function(e){this.messages=e}},updated:function(){this.$refs.messageArea.scrollTop=this.$refs.messageArea.scrollHeight}},h=b,x=(s("f607"),Object(f["a"])(h,a,n,!1,null,"47476a46",null));t["a"]=x.exports},4352:function(e,t,s){"use strict";s("ea28")},"498a":function(e,t,s){"use strict";var a=s("23e7"),n=s("58a8").trim,r=s("c8d2");a({target:"String",proto:!0,forced:r("trim")},{trim:function(){return n(this)}})},5899:function(e,t){e.exports="\t\n\v\f\r                　\u2028\u2029\ufeff"},"58a8":function(e,t,s){var a=s("1d80"),n=s("5899"),r="["+n+"]",i=RegExp("^"+r+r+"*"),c=RegExp(r+r+"*$"),o=function(e){return function(t){var s=String(a(t));return 1&e&&(s=s.replace(i,"")),2&e&&(s=s.replace(c,"")),s}};e.exports={start:o(1),end:o(2),trim:o(3)}},6565:function(e,t,s){"use strict";s.r(t);var a=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"main"},[s("div",{staticClass:"column-left column"},[s("Navbar")],1),s("div",{staticClass:"column-main column"},[s("div",{staticClass:"card main-content"},[s("ul",{staticClass:"list-group list-group-flush"},[s("PageHead",{attrs:{"static-title":"上線使用者("+e.onlineUsers.length+")"}}),e.isLoading?s("p",{staticClass:"loading"},[e._v("努力加載中...")]):e._e(),e._l(e.onlineUsers,(function(e){return s("OnlineUser",{key:e.id,attrs:{user:e}})}))],2)])]),s("div",{staticClass:"column-right column"},[s("PageHead",{attrs:{"static-title":"公開聊天室"}}),s("ChatRoom",{attrs:{"new-online-user":e.newOnlineUser,"new-offline-user":e.newOfflineUser,messages:e.messages}})],1)])},n=[],r=s("5530"),i=(s("b0c0"),s("4de4"),s("d81d"),s("d178")),c=s("cb06"),o=s("0b0f"),u=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("router-link",{staticClass:"list-group-item",attrs:{to:{name:"chat-private",params:{id:e.user.id}}}},[s("div",{staticClass:"card-body"},[s("div",{staticClass:"card-body-side"},[s("div",[s("img",{staticClass:"avatar",attrs:{src:e._f("emptyImage")(e.user.avatar),alt:""}})])]),s("div",{staticClass:"card-body-content"},[s("div",{staticClass:"content-header"},[s("span",{staticClass:"user-name"},[e._v(e._s(e.user.name))]),s("span",{staticClass:"text-muted"},[e._v(e._s(e.user.account))])])])])])},l=[],f=s("2708"),m={props:{user:{type:Object,required:!0}},mixins:[f["a"]]},d=m,p=(s("6a1a"),s("2877")),g=Object(p["a"])(d,u,l,!1,null,"9e2afc9c",null),v=g.exports,b=s("2f62"),h=s("2fa3"),x=s("56d7"),_={data:function(){return{isLoading:!1,newOnlineUser:{},newOfflineUser:{},onlineUsers:[],messages:[]}},components:{Navbar:i["a"],PageHead:c["a"],ChatRoom:o["a"],OnlineUser:v},computed:Object(r["a"])({},Object(b["b"])(["currentUser"])),created:function(){var e=this;x["socket"].removeAllListeners(),x["socket"].on("receiveUsers",(function(t){console.log("receiveUsers: ",t),e.onlineUsers=t})),x["socket"].on("receiveOnline",(function(t){console.log("receiveOnline: ",t);var s=t.id,a=t.name,n=t.avatar,r=t.account,i={id:s,name:a,avatar:n,account:r},c={text:"".concat(a," 上線"),type:"system"};e.messages.push(c),e.onlineUsers.every((function(e){return e.id!==s}))&&(e.onlineUsers.push(i),e.newOnlineUser=i)})),x["socket"].on("receiveOffline",(function(t){console.log("receiveOffline: ",t);var s=t.id,a=t.name;if(e.currentUser.id===s)return e.$store.commit("revokeAuthentication"),e.$router.push("/signin"),void h["a"].fire({icon:"warning",title:"此帳號已經被登出，請確定沒有重複登入並重新登入"});var n={text:"".concat(a," 離線"),type:"system"};e.messages.push(n),e.onlineUsers=e.onlineUsers.filter((function(e){return e.id!==s})),e.newOfflineUser=Object(r["a"])(Object(r["a"])({},e.newOfflineUser),t)})),x["socket"].on("getAllMessages",(function(t){console.log("all mesages: ",t),e.messages=t.map((function(t){return t.userId===e.currentUser.id?Object(r["a"])(Object(r["a"])({},t),{},{type:"self"}):Object(r["a"])(Object(r["a"])({},t),{},{type:"other"})}))})),x["socket"].on("receivePublic",(function(t){console.log("receive public: ",t);var s=t.userId,a=t.userName,n=t.userAvatar,r=t.text,i=t.createdAt,c="";c=r?s===e.currentUser.id?"self":"other":"system";var o={userId:s,type:c,userName:a,userAvatar:n,text:r,createdAt:i};e.messages.push(o)}))},mounted:function(){console.log("getting users"),x["socket"].emit("getUsers"),x["socket"].emit("messages")}},C=_,y=(s("8497"),Object(p["a"])(C,a,n,!1,null,"3a41a9bd",null));t["default"]=y.exports},"6a1a":function(e,t,s){"use strict";s("8c80")},7156:function(e,t,s){var a=s("861d"),n=s("d2bb");e.exports=function(e,t,s){var r,i;return n&&"function"==typeof(r=t.constructor)&&r!==s&&a(i=r.prototype)&&i!==s.prototype&&n(e,i),e}},8497:function(e,t,s){"use strict";s("bd1b")},"8c80":function(e,t,s){},a9e3:function(e,t,s){"use strict";var a=s("83ab"),n=s("da84"),r=s("94ca"),i=s("6eeb"),c=s("5135"),o=s("c6b6"),u=s("7156"),l=s("c04e"),f=s("d039"),m=s("7c73"),d=s("241c").f,p=s("06cf").f,g=s("9bf2").f,v=s("58a8").trim,b="Number",h=n[b],x=h.prototype,_=o(m(x))==b,C=function(e){var t,s,a,n,r,i,c,o,u=l(e,!1);if("string"==typeof u&&u.length>2)if(u=v(u),t=u.charCodeAt(0),43===t||45===t){if(s=u.charCodeAt(2),88===s||120===s)return NaN}else if(48===t){switch(u.charCodeAt(1)){case 66:case 98:a=2,n=49;break;case 79:case 111:a=8,n=55;break;default:return+u}for(r=u.slice(2),i=r.length,c=0;c<i;c++)if(o=r.charCodeAt(c),o<48||o>n)return NaN;return parseInt(r,a)}return+u};if(r(b,!h(" 0o1")||!h("0b1")||h("+0x1"))){for(var y,I=function(e){var t=arguments.length<1?0:e,s=this;return s instanceof I&&(_?f((function(){x.valueOf.call(s)})):o(s)!=b)?u(new h(C(t)),s,I):C(t)},O=a?d(h):"MAX_VALUE,MIN_VALUE,NaN,NEGATIVE_INFINITY,POSITIVE_INFINITY,EPSILON,isFinite,isInteger,isNaN,isSafeInteger,MAX_SAFE_INTEGER,MIN_SAFE_INTEGER,parseFloat,parseInt,isInteger,fromString,range".split(","),U=0;O.length>U;U++)c(h,y=O[U])&&!c(I,y)&&g(I,y,p(h,y));I.prototype=x,x.constructor=I,i(n,b,I)}},bd1b:function(e,t,s){},c8d2:function(e,t,s){var a=s("d039"),n=s("5899"),r="​᠎";e.exports=function(e){return a((function(){return!!n[e]()||r[e]()!=r||n[e].name!==e}))}},cb5c:function(e,t,s){},ea28:function(e,t,s){},f607:function(e,t,s){"use strict";s("cb5c")}}]);
//# sourceMappingURL=chunk-64609941.a049085c.js.map